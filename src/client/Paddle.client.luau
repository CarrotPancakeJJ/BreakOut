local UserInputService = game:GetService("UserInputService")
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local RunService = game:GetService("RunService")

local player = Players.LocalPlayer
local inRound = ReplicatedStorage:WaitForChild("InRound")
local movePaddleEvent = ReplicatedStorage:WaitForChild("MovePaddle")

-------------------------------------------------
-- Killer / Round ì²´í¬
-------------------------------------------------
local function isKiller()
	return player.Team and player.Team.Name == "Killer"
end

local function canMovePaddle()
	return isKiller() and inRound.Value
end

-------------------------------------------------
-- ì´ë™ ìƒíƒœ (PC / ëª¨ë°”ì¼ ê³µìš©)
-------------------------------------------------
local movingLeft = false
local movingRight = false

-------------------------------------------------
-- PC í‚¤ë³´ë“œ ìž…ë ¥ (ê¸°ì¡´ ê·¸ëŒ€ë¡œ)
-------------------------------------------------
local function setKeyState(keyCode, isDown)
	if keyCode == Enum.KeyCode.A or keyCode == Enum.KeyCode.Left then
		movingLeft = isDown
	elseif keyCode == Enum.KeyCode.D or keyCode == Enum.KeyCode.Right then
		movingRight = isDown
	end
end

UserInputService.InputBegan:Connect(function(input, gp)
	if gp or not canMovePaddle() then
		return
	end
	setKeyState(input.KeyCode, true)
end)

UserInputService.InputEnded:Connect(function(input)
	setKeyState(input.KeyCode, false)
end)

-------------------------------------------------
-- ðŸ“± ëª¨ë°”ì¼ ìŠ¤ì™€ì´í”„ â†’ í‚¤ ìž…ë ¥ì²˜ëŸ¼ ë³€í™˜
-------------------------------------------------
local touchStartX = nil
local SWIPE_THRESHOLD = 35

UserInputService.TouchStarted:Connect(function(touch, gp)
	if gp or not canMovePaddle() then
		return
	end
	touchStartX = touch.Position.X
end)

UserInputService.TouchMoved:Connect(function(touch, gp)
	if not touchStartX or not canMovePaddle() then
		return
	end

	local deltaX = touch.Position.X - touchStartX

	if deltaX > SWIPE_THRESHOLD then
		-- ì˜¤ë¥¸ìª½ í‚¤ ëˆ„ë¥¸ ê²ƒì²˜ëŸ¼
		movingRight = true
		movingLeft = false
	elseif deltaX < -SWIPE_THRESHOLD then
		-- ì™¼ìª½ í‚¤ ëˆ„ë¥¸ ê²ƒì²˜ëŸ¼
		movingLeft = true
		movingRight = false
	else
		movingLeft = false
		movingRight = false
	end
end)

UserInputService.TouchEnded:Connect(function()
	touchStartX = nil
	movingLeft = false
	movingRight = false
end)

-------------------------------------------------
-- ì„œë²„ ì „ì†¡ ë£¨í”„ (ê¸°ì¡´ êµ¬ì¡° ìœ ì§€)
-------------------------------------------------
RunService.RenderStepped:Connect(function()
	if not canMovePaddle() then
		return
	end

	local direction = 0
	if movingLeft then
		direction = -1
	elseif movingRight then
		direction = 1
	end

	if direction ~= 0 then
		movePaddleEvent:FireServer(direction)
	end
end)

print("âœ… PC í‚¤ë³´ë“œ + ëª¨ë°”ì¼ ìŠ¤ì™€ì´í”„ = ë™ì¼ ìž…ë ¥ ì²´ê³„ ì™„ë£Œ")
