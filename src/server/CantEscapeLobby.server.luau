local Players = game:GetService("Players")
local lobbyObjects = workspace:WaitForChild("LobbyObjects")
local happyBall = lobbyObjects:WaitForChild("HappyBall")
local howtoplay = lobbyObjects:WaitForChild("HowToPlay")
local outField = lobbyObjects:WaitForChild("OutField")
-- HappyBall ì•ˆì˜ ì‚¬ìš´ë“œ
local oofSound = happyBall:WaitForChild("OOF")

-- ì¿¨íƒ€ì„
local playerCooldowns = {}
local happyBallTeleportCooldown = false
local happyBallSoundCooldown = false
local howtoplayTeleportCooldown = false

------------------------------------------------
-- ë¡œë¹„ ìŠ¤í° ëœë¤
------------------------------------------------
local function getRandomLobbySpawn()
	local spawnsFolder = lobbyObjects:WaitForChild("LobbySpawns")
	local spawns = spawnsFolder:GetChildren()

	if #spawns == 0 then
		return nil
	end

	return spawns[math.random(1, #spawns)]
end

------------------------------------------------
-- í…”ë ˆí¬íŠ¸ í•¨ìˆ˜
------------------------------------------------
local function teleportToLobby(part)
	if not part or not part:IsA("BasePart") then
		return
	end

	local lobbySpawn = getRandomLobbySpawn()
	if not lobbySpawn then
		warn("LobbySpawnì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!")
		return
	end

	part.Velocity = Vector3.zero
	part.AssemblyLinearVelocity = Vector3.zero
	part.CFrame = lobbySpawn.CFrame + Vector3.new(0, 3, 0)
end

------------------------------------------------
-- OutField ì¶©ëŒ ì²˜ë¦¬
------------------------------------------------
outField.Touched:Connect(function(hit)
	local character = hit.Parent

	-- í”Œë ˆì´ì–´
	if character then
		local player = Players:GetPlayerFromCharacter(character)
		if player and character:FindFirstChild("HumanoidRootPart") then
			if not playerCooldowns[player.UserId] then
				playerCooldowns[player.UserId] = true
				teleportToLobby(character.HumanoidRootPart)

				task.delay(0.1, function()
					playerCooldowns[player.UserId] = nil
				end)
			end
		end
	end

	-- HappyBall
	if hit == happyBall then
		if not happyBallTeleportCooldown then
			happyBallTeleportCooldown = true
			teleportToLobby(happyBall)

			task.delay(0.1, function()
				happyBallTeleportCooldown = false
			end)
		end
	end

	-- HappyBall
	if hit == howtoplay then
		if not howtoplayTeleportCooldown then
			howtoplayTeleportCooldown = true
			teleportToLobby(howtoplay)

			task.delay(0.1, function()
				howtoplayTeleportCooldown = false
			end)
		end
	end
end)

------------------------------------------------
-- HappyBall â†” í”Œë ˆì´ì–´ ì¶©ëŒ ì‹œ ì‚¬ìš´ë“œ (3D)
------------------------------------------------
happyBall.Touched:Connect(function(hit)
	local character = hit.Parent
	if not character then
		return
	end

	local player = Players:GetPlayerFromCharacter(character)
	if not player then
		return
	end

	if happyBallSoundCooldown then
		return
	end
	happyBallSoundCooldown = true

	oofSound:Play() -- ğŸ”Š ê³µ ìœ„ì¹˜ì—ì„œ 3D ì‚¬ìš´ë“œ ì¬ìƒ

	task.delay(3, function()
		happyBallSoundCooldown = false
	end)
end)
